<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ComfyUI Img2Img 서비스</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .preview-box {
            border: 2px dashed #ccc;
            padding: 10px;
            text-align: center;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .preview-box img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
        }

    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light px-4">
  <a class="navbar-brand" href="/">ComfyUI Img2Img</a>
  <div class="ms-auto d-flex align-items-center">
    {% if user.is_authenticated %}
      <span class="me-3">안녕하세요, {{ user.username }}님</span>

      <!-- ✅ 로그아웃: 반드시 form으로 POST 방식 사용 -->
      <form method="post" action="{% url 'logout' %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-outline-secondary">로그아웃</button>
      </form>

    {% else %}
      <a href="{% url 'login' %}" class="btn btn-outline-primary me-2">로그인</a>
      <a href="{% url 'signup' %}" class="btn btn-primary">회원가입</a>
    {% endif %}
  </div>
</nav>
<div class="container mt-4">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-warning mt-3">{{ message }}</div>
        {% endfor %}
    {% endif %}
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row">
            <!-- 왼쪽: 입력 이미지 선택 -->
            <div class="col-md-4">
                <h5>원본 이미지 선택</h5>
                <div class="preview-box mb-2" id="preview-box">
                    <span>이미지를 선택하세요</span>
                </div>
                <input type="file" name="input_image" id="input_image" class="form-control" accept="image/*" required>
                
        
            </div>

            <!-- 가운데: 변환 버튼 -->
            <div class="col-md-4 d-flex align-items-center justify-content-center">
                <button type="submit" class="btn btn-success btn-lg">변환하기</button>
            </div>

            <!-- 오른쪽: 결과 이미지 -->
            <div class="col-md-4">
                <h5>변환된 이미지</h5>
                <div class="preview-box">
                    {% if result_image %}
                        <img src="/media/{{ result_image }}" alt="변환 결과">
                    {% else %}
                        <span>아직 변환되지 않았습니다</span>
                    {% endif %}


                </div> 
                    {% if result_image %}
                        <a href="/media/{{ result_image }}" class="btn btn-outline-primary mt-3" download>결과 이미지 다운로드</a>
                    {% endif %}
            </div>
        </div>

        {% if error %}
            <div class="alert alert-danger mt-4">{{ error }}</div>
        {% endif %}
    </form>
</div>

<!-- JS: 이미지 미리보기 -->
<script>
    const inputImage = document.getElementById('input_image');
    const previewBox = document.getElementById('preview-box');

    inputImage.addEventListener('change', function () {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                previewBox.innerHTML = `<img src="${e.target.result}" alt="미리보기 이미지">`;
            }
            reader.readAsDataURL(file);
        } else {
            previewBox.innerHTML = `<span>이미지를 선택하세요</span>`;
        }
    });
</script>

</body>
</html>
